---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
---

<header>
	<nav>
		<h2><a href="/">{SITE_TITLE}</a></h2>
		<div class="internal-links desktop-menu">
			<HeaderLink href="/">ホーム</HeaderLink>
			<HeaderLink href="/blog">ブログ</HeaderLink>
			<HeaderLink href="/profile">プロフィール</HeaderLink>
			<HeaderLink href="/works">成果物</HeaderLink>
			<HeaderLink href="/contact">お問い合わせ</HeaderLink>
		</div>
		<button class="hamburger-button" id="hamburger-button" aria-label="メニュー" aria-expanded="false" type="button">
			<span class="hamburger-icon"></span>
			<span class="close-icon"></span>
		</button>
		<div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>
		<div class="mobile-menu" id="mobile-menu">
			<div class="mobile-menu-content">
				<HeaderLink href="/">ホーム</HeaderLink>
				<HeaderLink href="/blog">ブログ</HeaderLink>
				<HeaderLink href="/profile">プロフィール</HeaderLink>
				<HeaderLink href="/works">成果物</HeaderLink>
				<HeaderLink href="/contact">お問い合わせ</HeaderLink>
			</div>
		</div>
	</nav>
</header>
<script>
	(function() {
		const hamburgerButton = document.getElementById('hamburger-button');
		const mobileMenu = document.getElementById('mobile-menu');
		const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

		if (!hamburgerButton || !mobileMenu || !mobileMenuOverlay) return;

		let isMenuOpen = false;

		function openMenu() {
			if (isMenuOpen) return;
			if (!mobileMenu || !mobileMenuOverlay || !hamburgerButton) return;
			isMenuOpen = true;
			mobileMenu.classList.add('mobile-menu-open');
			mobileMenuOverlay.classList.add('mobile-menu-overlay-visible');
			hamburgerButton.classList.add('hamburger-button-open');
			hamburgerButton.setAttribute('aria-expanded', 'true');
			document.body.style.overflow = 'hidden';
		}

		function closeMenu() {
			if (!isMenuOpen) return;
			if (!mobileMenu || !mobileMenuOverlay || !hamburgerButton) return;
			isMenuOpen = false;
			mobileMenu.classList.remove('mobile-menu-open');
			mobileMenuOverlay.classList.remove('mobile-menu-overlay-visible');
			hamburgerButton.classList.remove('hamburger-button-open');
			hamburgerButton.setAttribute('aria-expanded', 'false');
			document.body.style.overflow = '';
		}

		function toggleMenu(e?: Event) {
			if (e) e.stopPropagation();
			isMenuOpen ? closeMenu() : openMenu();
		}

		hamburgerButton.addEventListener('click', toggleMenu);
		
		// オーバーレイクリックでメニューを閉じる
		mobileMenuOverlay.addEventListener('click', closeMenu);
		
		// メニュー内のクリックはメニューを閉じない（リンクのみ閉じる）
		mobileMenu.addEventListener('click', (e) => {
			const target = e.target as HTMLElement;
			if (target.tagName === 'A' || target.closest('a')) {
				closeMenu();
			}
		});

		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape' && isMenuOpen) {
				closeMenu();
			}
		});

		// ウィンドウリサイズ時にメニューを閉じる
		let resizeTimer: ReturnType<typeof setTimeout> | null = null;
		window.addEventListener('resize', () => {
			if (resizeTimer) clearTimeout(resizeTimer);
			resizeTimer = setTimeout(() => {
				if (window.innerWidth > 768 && isMenuOpen) {
					closeMenu();
				}
			}, 150);
		});
	})();
</script>
<style>
	header {
		background: rgba(var(--white), 0.95);
		border-bottom: 1px solid rgb(var(--gray-light));
		position: sticky;
		top: 0;
		z-index: 1001;
		backdrop-filter: blur(10px);
	}
	
	h2 {
		margin: 0;
		font-size: 1.25em;
		font-weight: 700;
	}
	
	h2 a {
		color: rgb(var(--black));
		text-decoration: none;
		transition: color 0.2s;
	}
	
	h2 a:hover {
		color: var(--accent);
	}
	
	nav {
		display: flex;
		align-items: center;
		justify-content: space-between;
		max-width: 1200px;
		margin: 0 auto;
		padding: 1.25em 2em;
	}
	
	.desktop-menu {
		display: flex;
		gap: 0.5em;
		align-items: center;
	}
	
	.hamburger-button {
		display: none;
		background: none;
		border: none;
		cursor: pointer;
		padding: 0.5em;
		width: 40px;
		height: 40px;
		position: relative;
		flex-shrink: 0;
	}

	.hamburger-icon,
	.close-icon {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		width: 20px;
		height: 2px;
		background: rgb(var(--black));
		transition: opacity 0.2s;
	}

	.hamburger-icon::before,
	.hamburger-icon::after {
		content: '';
		position: absolute;
		width: 20px;
		height: 2px;
		background: rgb(var(--black));
		left: 0;
	}

	.hamburger-icon::before {
		top: -6px;
	}

	.hamburger-icon::after {
		top: 6px;
	}

	.close-icon {
		opacity: 0;
		transform: translate(-50%, -50%) rotate(45deg);
	}

	.close-icon::after {
		content: '';
		position: absolute;
		width: 20px;
		height: 2px;
		background: rgb(var(--black));
		top: 0;
		left: 0;
		transform: rotate(90deg);
	}

	.hamburger-button-open .hamburger-icon {
		opacity: 0;
	}

	.hamburger-button-open .close-icon {
		opacity: 1;
	}

	.mobile-menu-overlay {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		width: 100vw;
		height: 100vh;
		height: 100dvh;
		background: rgba(0, 0, 0, 0.5);
		z-index: 999;
		opacity: 0;
		visibility: hidden;
		transition: opacity 0.2s, visibility 0.2s;
		pointer-events: none;
	}

	.mobile-menu-overlay-visible {
		opacity: 1;
		visibility: visible;
		pointer-events: auto;
	}

	.mobile-menu {
		display: none;
		position: fixed;
		top: 0;
		right: 0;
		width: 280px;
		max-width: 80vw;
		height: 100vh;
		height: 100dvh;
		background: rgb(var(--white));
		/* box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1); */
		z-index: 1000;
		overflow-y: auto;
		transform: translateX(100%);
		transition: transform 0.2s ease;
	}

	.mobile-menu-open {
		transform: translateX(0);
	}

	.mobile-menu-content {
		padding: 5em 1.5em 2em;
		display: flex;
		flex-direction: column;
		gap: 0.25em;
	}

	.mobile-menu-content a {
		padding: 1em;
		display: block;
		border-radius: var(--border-radius);
	}

	@media (max-width: 768px) {
		nav {
			padding: 1em;
		}
		
		h2 {
			font-size: 1.1em;
		}
		
		.desktop-menu {
			display: none !important;
		}

		.hamburger-button {
			display: block;
		}

		.mobile-menu {
			display: block;
		}
	}
</style>
