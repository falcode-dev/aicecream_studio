---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import '../styles/blog-post.css';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage, category } = Astro.props;

// 日付を「yyyy年mm月dd日 hh時mm分」形式にフォーマット
function formatDateTime(date: Date): string {
	const year = date.getFullYear();
	const month = String(date.getMonth() + 1).padStart(2, '0');
	const day = String(date.getDate()).padStart(2, '0');
	const hours = String(date.getHours()).padStart(2, '0');
	const minutes = String(date.getMinutes()).padStart(2, '0');
	return `${year}年${month}月${day}日 ${hours}時${minutes}分`;
}
---

<html lang="ja">
	<head>
		<BaseHead title={title} description={description} />
	</head>

	<body>
		<Header />
		<main>
			<article>
				<div class="breadcrumb">
					<nav aria-label="パンくずリスト">
						<ol>
							<li><a href="/">ホーム</a></li>
							<li><a href="/blog">ブログ</a></li>
							{category && (
								<li>
									<a href={`/blog?category=${encodeURIComponent(category)}`}>{category}</a>
								</li>
							)}
							<li aria-current="page">{title}</li>
						</ol>
					</nav>
				</div>
				<div class="hero-image">
					{heroImage && <Image width={1020} height={510} src={heroImage} alt="" />}
				</div>
				<div class="prose">
					<div class="title">
						{category && (
							<div class="category-badge">
								<span>{category}</span>
							</div>
						)}
						<div class="date-time">
							<div class="date-item">
								<div class="date-icon">
									<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<circle cx="12" cy="12" r="10" />
										<polyline points="12 6 12 12 16 14" />
									</svg>
								</div>
								<span class="date-label">公開日</span>
								<time datetime={pubDate.toISOString()} class="date-value">
									{formatDateTime(pubDate)}
								</time>
							</div>
							{
								updatedDate && (
									<div class="date-item">
										<div class="date-icon">
											<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
												<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
												<circle cx="12" cy="10" r="3" />
											</svg>
										</div>
										<span class="date-label">更新日</span>
										<time datetime={updatedDate.toISOString()} class="date-value">
											{formatDateTime(updatedDate)}
										</time>
									</div>
								)
							}
						</div>
						<h1>{title}</h1>
						<div class="icon-buttons">
							<button class="icon-button" title="勉強" aria-label="勉強">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" />
									<path d="M8 8h6" />
									<path d="M8 12h6" />
								</svg>
							</button>
							<button class="icon-button share-button" title="共有" aria-label="共有">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<circle cx="18" cy="5" r="3" />
									<circle cx="6" cy="12" r="3" />
									<circle cx="18" cy="19" r="3" />
									<line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
									<line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
								</svg>
							</button>
						</div>
					</div>
					<slot />
				</div>
			</article>
		</main>
		<Footer />
		<script is:inline>
			document.addEventListener('DOMContentLoaded', () => {
				const shareButton = document.querySelector('.share-button');
				if (shareButton) {
					shareButton.addEventListener('click', async () => {
						const url = window.location.href;
						const title = document.title;
						
						if (navigator.share) {
							try {
								await navigator.share({
									title: title,
									url: url
								});
							} catch (err) {
								console.log('共有がキャンセルされました');
							}
						} else {
							try {
								await navigator.clipboard.writeText(url);
								alert('リンクをコピーしました');
							} catch (err) {
								console.error('コピーに失敗しました:', err);
							}
						}
					});
				}
			});
		</script>
	</body>
</html>
